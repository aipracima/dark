{"createdAt":"2025-07-02T00:44:31.510Z","updatedAt":"2025-07-03T01:11:43.000Z","id":"2t7K3loG6LHAHWmG","name":"WF06 - CRIAR IMAGEM - ENG - @mojaobiteljx","active":true,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[-4920,840],"id":"fc0ff5c1-4f52-4288-bdf6-13d3fe25f61b","name":"Detector de Falhas","disabled":true},{"parameters":{"chatId":"-1002628528187","text":"=06 - CRIA IMAGENS","additionalFields":{"appendAttribution":false,"message_thread_id":3}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-4700,840],"id":"3bb37f6a-2d5c-4cba-9db8-265a1be7be77","name":"Notificação de Erro no Telegram","webhookId":"d681d739-fb4a-44e0-88a0-9fdfef7a1938","disabled":true},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-3572,700],"id":"2820d569-9085-4ffd-af3c-fa368e3c1e75","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"kJFBDdj4hIWEcn59","name":"OpenAi account"}}},{"parameters":{"resource":"list","operation":"getCards","id":"={{ $item(\"0\").$node[\"Edit Fields1\"].json[\"ÁUDIOS LONGOS\"] }}","returnAll":true,"additionalFields":{}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-4480,480],"id":"5b0bb72a-3f73-4435-98ad-d59b90d3ac20","name":"Buscar Cartões com Solicitações de Imagem1","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-4040,480],"id":"85a841e8-8a84-4501-8529-6b7be50d2702","name":"Selecionar Próximo Cartão da Fila1"},{"parameters":{"promptType":"define","text":"={{ $json.desc }}","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-3600,480],"id":"2bacb6de-6d79-4f8a-9f87-65a97868e0bd","name":"Extrair Dados do Cartão1"},{"parameters":{"jsonSchemaExample":"{\n\"título\": \"{{ $('Edit Fields2').item.json['título'] }}\",\n\"seo\": \"{{ $('Edit Fields2').item.json.seo }}\",\n\"pasta\": \"{{ $('Edit Fields2').item.json.pasta }}\",\n\"card\": \"{{ $('Edit Fields2').item.json.card }}\",\n\"audiolongo1\": \"{{ $('Edit Fields2').item.json.audiolongo1 }}\",\n\"audiolongo2\": \"{{ $('Edit Fields2').item.json.audiolongo2 }}\",\n\"audiolongo3\": \"{{ $('Edit Fields2').item.json.audiolongo3 }}\",\n\"audiolongo4\": \"{{ $('Edit Fields2').item.json.audiolongo4 }}\",\n\"audiolongo5\": \"{{ $('Edit Fields2').item.json.audiolongo5 }}\",\n\"audiolongo6\": \"{{ $('Edit Fields2').item.json.audiolongo6 }}\",\n\"audiolongo7\": \"{{ $('Edit Fields2').item.json.audiolongo7 }}\",\n\"audiolongo8\": \"{{ $('Edit Fields2').item.json.audiolongo8 }}\",\n\"audiolongo9\": \"{{ $('Edit Fields2').item.json.audiolongo9 }}\",\n\"audiolongo10\": \"{{ $('Edit Fields2').item.json.audiolongo10 }}\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3452,700],"id":"39d9aece-f1e0-4a4a-8fe7-52706bf912f8","name":"Formatar Saída Estruturada1"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-3224,480],"id":"7a593ff6-d666-44f1-af4f-4f19a5c8a9b3","name":"Consolidar Dados do Cartão1"},{"parameters":{"resource":"folder","name":"Imagens","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $json.output[0].pasta }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-3004,480],"id":"aff6178d-03d6-4661-b28f-d3c35703ff74","name":"Criar Pasta para Imagens no Drive1","credentials":{"googleDriveOAuth2Api":{"id":"uOMKQ3hoFwWVj3KJ","name":"chroniclesabduction@gmail.com"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Create a prompt for ChatGPT to create an image like a professional photograph based on the theme: {{ $item(\"0\").$node[\"Consolidar Dados do Cartão1\"].json[\"output\"][\"0\"][\"título\"] }}. Show a clear and intense emotional expression [choose one: sadness/joy/anger/surprise/fear] appropriate to the title's context. Use lighting that highlights the main subject. Keep the realistic style with vivid colors. No text in the image. High resolution. Provide only the prompt. Return the text without double quotes, with a maximum of 300 characters, clearly and objectively."}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2784,480],"id":"e99eb52a-4abf-4af3-9680-3c25c362b858","name":"Gerar Descrição para Imagem1","credentials":{"openAiApi":{"id":"kJFBDdj4hIWEcn59","name":"OpenAi account"}}},{"parameters":{"assignments":{"assignments":[{"id":"ff5f86c0-dc5e-43d6-9990-9d264d447804","name":"message.content0","value":"={{ $json.message.content }}","type":"string"},{"id":"70b3db8c-461c-4c13-97a5-ca51cddb293c","name":"message.content1","value":"={{ $json.message.content }}","type":"string"},{"id":"d9a6e1ae-34af-4cc5-8bdd-a7733f563dcd","name":"message.content2","value":"={{ $json.message.content }}","type":"string"},{"id":"294ac06b-3269-488f-9330-5f9b45e38c2c","name":"message.content3","value":"={{ $json.message.content }}","type":"string"},{"id":"05542c2a-a8fb-49e6-8697-79767754b75e","name":"message.content4","value":"={{ $json.message.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2408,480],"id":"6f996df7-9581-42f3-bea4-f19f51639235","name":"Preparar Múltiplas Descrições1"},{"parameters":{"fieldToSplitOut":"message","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-2188,480],"id":"a580eefa-6d33-44be-b402-8249e87afb0a","name":"Separar Descrições Individuais1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1968,480],"id":"d07ed2f8-d024-4fe3-8cce-715a878d2e54","name":"Processar Cada Descrição1"},{"parameters":{"method":"POST","url":"https://api.together.xyz/v1/chat/completions","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $item(\"0\").$node[\"Edit Fields1\"].json[\"Together API Key\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"black-forest-labs/FLUX.1-schnell\",\n  \"prompt\": {{ JSON.stringify($json.message) }},\n  \"width\": 1280,\n  \"height\": 720,\n  \"steps\": 4,\n  \"n\": 1,\n  \"response_format\": \"b64_json\"\n}","options":{"batching":{"batch":{"batchSize":2,"batchInterval":10000}}}},"id":"ca539e0c-43ff-4025-88a9-f669aa513f6a","name":"Solicitar Imagem à Together.xyz1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1748,480],"retryOnFail":true,"maxTries":2},{"parameters":{"operation":"toBinary","sourceProperty":"output.choices[0].image_base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1528,480],"id":"3d0af393-d513-43eb-8c46-a538f23a0da5","name":"Converter Base64 para Arquivo1"},{"parameters":{"operation":"text","text":"={{ $('Selecionar Próximo Cartão da Fila1').item.json.name }}","fontSize":50,"fontColor":"#FFFFFF","positionX":40,"positionY":80,"options":{"font":"/usr/share/fonts/truetype/msttcorefonts/Arial_Bold.ttf","format":"jpeg"}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[-1308,480],"id":"02e403a1-aae9-43cb-8a4f-d7ff2f67f9d0","name":"Adicionar Marca d'água1","disabled":true},{"parameters":{"name":"img","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $('Criar Pasta para Imagens no Drive1').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1088,480],"id":"95ab1813-00fe-40b3-b14d-bc4ca763acf2","name":"Salvar Imagem no Google Drive1","credentials":{"googleDriveOAuth2Api":{"id":"uOMKQ3hoFwWVj3KJ","name":"chroniclesabduction@gmail.com"}}},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-868,555],"id":"f30e45e3-d06f-4db4-a50e-35b40dc43e74","name":"Aguardar Processamento1","webhookId":"8644fef5-f0bd-457c-93ae-f9f85bfaa870"},{"parameters":{"fieldToSplitOut":"id","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-1748,280],"id":"766e8647-8680-48ed-b9ab-eb83f388059e","name":"Separar IDs das Imagens1"},{"parameters":{"aggregate":"={{ $json.id }}","fieldsToAggregate":{"fieldToAggregate":[{}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-1528,280],"id":"b1e1a43d-6470-46d1-8d25-8fae709f5e62","name":"Agrupar IDs de Imagens1"},{"parameters":{"assignments":{"assignments":[{"id":"a17bebb8-7f04-4f2e-bdd7-a6e4be63b784","name":"img1","value":"={{ $json.data[0].id }}","type":"string"},{"id":"4af0684d-d1f5-4ff2-abfa-bebb37541b38","name":"img2","value":"={{ $json.data[1].id }}","type":"string"},{"id":"06d07776-31a3-4d16-96ca-dc3921f38d72","name":"img3","value":"={{ $json.data[2].id }}","type":"string"},{"id":"c5578725-5ab1-4791-84fc-33cc240d7334","name":"img4","value":"={{ $json.data[3].id }}","type":"string"},{"id":"b81e2d42-39c3-4473-bb46-1de60302bbec","name":"img5","value":"={{ $json.data[4].id }}","type":"string"},{"id":"2bef0356-8b6a-4157-a38c-4dce875aff69","name":"img6","value":"={{ $json.data[5].id }}","type":"string"},{"id":"eafad461-9b99-4aa0-b7e5-68aff9c82a8a","name":"img7","value":"={{ $json.data[6].id }}","type":"string"},{"id":"db040239-d6c0-47e4-9515-dd4fcaad7f76","name":"img8","value":"={{ $json.data[7].id }}","type":"string"},{"id":"1028a556-10a5-4b79-b198-f95622eabef7","name":"img9","value":"={{ $json.data[8].id }}","type":"string"},{"id":"5044bbf1-0d4c-447b-bd2a-92ab1d361ce9","name":"img10","value":"={{ $json.data[9].id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1308,280],"id":"b6e08c21-23ee-4c68-a838-4d6377e27cf6","name":"Formatar IDs para Trello1"},{"parameters":{"operation":"get","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão da Fila1\"].json[\"id\"] }}","mode":"id"},"additionalFields":{}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-1088,280],"id":"a02beabd-e54b-44bc-a516-92e1efad917a","name":"Carregar Detalhes do Cartão1","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"desc":"={{ $json.desc }}\n\"img1\": \"{{ $('Formatar IDs para Trello1').item.json.img1 }}\",\n\"img2\": \"{{ $('Formatar IDs para Trello1').item.json.img2 }}\",\n\"img3\": \"{{ $('Formatar IDs para Trello1').item.json.img3 }}\",\n\"img4\": \"{{ $('Formatar IDs para Trello1').item.json.img4 }}\",\n\"img5\": \"{{ $('Formatar IDs para Trello1').item.json.img5 }}\","}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-868,280],"id":"758bdb56-7452-4bd0-b161-3a6e3774a6d6","name":"Atualizar Cartão com Links das Imagens1","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"chatId":"-1002628528187","text":"=06 - CRIA IMAGENS","additionalFields":{"appendAttribution":false,"message_thread_id":3}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-4920,1100],"id":"3358c1bf-36e2-4670-a94e-7b9f6893630a","name":"Notificação de Erro no Telegram1","webhookId":"67246ef9-638c-4b06-a9d6-ad79329c71c5","disabled":true},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão da Fila1\"].json[\"id\"] }}","mode":""},"updateFields":{"idList":"={{ $item(\"0\").$node[\"Edit Fields1\"].json[\"IMAGENS\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-648,280],"id":"68821407-a975-4eb0-86e0-7793ebc7d8e1","name":"Mover Cartão para \"IMAGENS ✅\"1","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"015448b3-2848-46c1-92d6-cc3f867bbed1","leftValue":"={{ $json.name }}","rightValue":"\"STOP\"","operator":{"type":"string","operation":"notContains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-4260,480],"id":"c0753ad6-11f3-4ecf-a58b-18902eb961cf","name":"Exclui Cards em \"STOP\"1"},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"name":"={{ $json.name }} \"STOP\""}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-3820,480],"id":"e1d51384-9d89-4941-9711-0cc255c0e697","name":"Atualizar Cartão com \"STOP\"1","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"name":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão da Fila1\"].json[\"name\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-428,280],"id":"b06dfcf1-0605-4f0d-90e0-2894df7392e7","name":"Remove \"STOP\"1","retryOnFail":true,"credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"assignments":{"assignments":[{"id":"948aa1b6-75d6-4cf6-9cd1-629b97a571d6","name":"ÁUDIOS LONGOS","value":"684e99f4d2ade5c74efc240e","type":"string"},{"id":"41fb9577-343d-439a-bacf-65018b3f194c","name":"IMAGENS","value":"684e99f4d2ade5c74efc240b","type":"string"},{"id":"f42a20f1-0812-4b36-bd40-5d779ca6e7ad","name":"Together API Key","value":"6a22e414358b3232820a65a17b23613f4176cb89329e373fb1cf2d0b5aeac235","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4700,480],"id":"d5026493-105e-4752-a903-847dd522f9ab","name":"Edit Fields1"},{"parameters":{"rule":{"interval":[{"triggerAtHour":2,"triggerAtMinute":43},{"triggerAtHour":9,"triggerAtMinute":8}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-4920,480],"id":"59dc7604-9d85-4b3b-a0fe-5756768a014b","name":"00:43"}],"connections":{"Detector de Falhas":{"main":[[{"node":"Notificação de Erro no Telegram","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Extrair Dados do Cartão1","type":"ai_languageModel","index":0}]]},"Buscar Cartões com Solicitações de Imagem1":{"main":[[{"node":"Exclui Cards em \"STOP\"1","type":"main","index":0}]]},"Selecionar Próximo Cartão da Fila1":{"main":[[{"node":"Atualizar Cartão com \"STOP\"1","type":"main","index":0}]]},"Extrair Dados do Cartão1":{"main":[[{"node":"Consolidar Dados do Cartão1","type":"main","index":0}]]},"Formatar Saída Estruturada1":{"ai_outputParser":[[{"node":"Extrair Dados do Cartão1","type":"ai_outputParser","index":0}]]},"Consolidar Dados do Cartão1":{"main":[[{"node":"Criar Pasta para Imagens no Drive1","type":"main","index":0}]]},"Criar Pasta para Imagens no Drive1":{"main":[[{"node":"Gerar Descrição para Imagem1","type":"main","index":0}]]},"Gerar Descrição para Imagem1":{"main":[[{"node":"Preparar Múltiplas Descrições1","type":"main","index":0}]]},"Preparar Múltiplas Descrições1":{"main":[[{"node":"Separar Descrições Individuais1","type":"main","index":0}]]},"Separar Descrições Individuais1":{"main":[[{"node":"Processar Cada Descrição1","type":"main","index":0}]]},"Processar Cada Descrição1":{"main":[[{"node":"Separar IDs das Imagens1","type":"main","index":0}],[{"node":"Solicitar Imagem à Together.xyz1","type":"main","index":0}]]},"Solicitar Imagem à Together.xyz1":{"main":[[{"node":"Converter Base64 para Arquivo1","type":"main","index":0}]]},"Converter Base64 para Arquivo1":{"main":[[{"node":"Adicionar Marca d'água1","type":"main","index":0}]]},"Adicionar Marca d'água1":{"main":[[{"node":"Salvar Imagem no Google Drive1","type":"main","index":0}]]},"Salvar Imagem no Google Drive1":{"main":[[{"node":"Aguardar Processamento1","type":"main","index":0}]]},"Aguardar Processamento1":{"main":[[{"node":"Processar Cada Descrição1","type":"main","index":0}]]},"Separar IDs das Imagens1":{"main":[[{"node":"Agrupar IDs de Imagens1","type":"main","index":0}]]},"Agrupar IDs de Imagens1":{"main":[[{"node":"Formatar IDs para Trello1","type":"main","index":0}]]},"Formatar IDs para Trello1":{"main":[[{"node":"Carregar Detalhes do Cartão1","type":"main","index":0}]]},"Carregar Detalhes do Cartão1":{"main":[[{"node":"Atualizar Cartão com Links das Imagens1","type":"main","index":0}]]},"Atualizar Cartão com Links das Imagens1":{"main":[[{"node":"Mover Cartão para \"IMAGENS ✅\"1","type":"main","index":0}]]},"Mover Cartão para \"IMAGENS ✅\"1":{"main":[[{"node":"Remove \"STOP\"1","type":"main","index":0}]]},"Exclui Cards em \"STOP\"1":{"main":[[{"node":"Selecionar Próximo Cartão da Fila1","type":"main","index":0}]]},"Atualizar Cartão com \"STOP\"1":{"main":[[{"node":"Extrair Dados do Cartão1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Buscar Cartões com Solicitações de Imagem1","type":"main","index":0}]]},"00:43":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:07:09":{"recurrenceRules":[]},"node:00:43":{"recurrenceRules":[]}},"meta":null,"pinData":{},"versionId":"4e0a87f4-33fb-413b-a805-7189c76e9632","triggerCount":1,"tags":[]}