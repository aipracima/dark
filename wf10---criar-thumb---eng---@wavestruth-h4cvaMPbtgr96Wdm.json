{"createdAt":"2025-06-25T00:39:53.523Z","updatedAt":"2025-06-27T12:14:44.000Z","id":"h4cvaMPbtgr96Wdm","name":"WF10 - CRIAR THUMB - ENG - @wavestruth","active":false,"isArchived":false,"nodes":[{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-3140,460],"id":"594c886c-4c86-419f-ae5a-76a51ba6a76c","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"kJFBDdj4hIWEcn59","name":"OpenAi account"}}},{"parameters":{"resource":"list","operation":"getCards","id":"={{ $item(\"0\").$node[\"Edit Fields\"].json[\"UPLOAD\"] }}","returnAll":true,"additionalFields":{}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-4060,220],"id":"e20bb4d2-e250-43c3-af4e-b03aa15cd403","name":"Buscar Cartões Prontos para Thumbnail","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-3620,220],"id":"869504c3-3141-45da-ac07-337af0da9f25","name":"Selecionar Próximo Cartão"},{"parameters":{"promptType":"define","text":"={{ $json.desc }}","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-3180,220],"id":"ca32fed8-88aa-4817-975c-ff43a1b35388","name":"Extrair Metadados do Cartão"},{"parameters":{"jsonSchemaExample":"{\n\"título\": \"{{ $('Edit Fields2').item.json.pasta }}\",\n\"pasta\": \"{{ $('Edit Fields2').item.json.pasta }}\",\n\"id\": \"{{ $('Edit Fields2').item.json.audiolongo1 }}\",\n\"url\": \"{{ $('Edit Fields2').item.json.audiolongo2 }}\",\n\"data\": \"{{ $('Edit Fields2').item.json.audiolongo2 }}\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3020,460],"id":"0c7c372e-fbeb-4914-95bd-65b7d75c7def","name":"Formatador de Dados JSON"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-2800,220],"id":"020a36c3-f7dc-4059-aac3-77391ee5e203","name":"Consolidar Dados do Cartão"},{"parameters":{"fieldToSplitOut":"output[0]['título'], output[0].pasta","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-2580,220],"id":"e6d78e8e-62f7-4578-a64c-c8963ad36b01","name":"Extrair Título e Pasta"},{"parameters":{"assignments":{"assignments":[{"id":"20da253b-0135-4a09-a0e2-46342c2076c5","name":"título","value":"={{ $json['output[0][\\'título\\']'] }}","type":"string"},{"id":"cb5ec656-9691-450f-99f8-bb9f23a99ff8","name":"id","value":"={{ $json['output[0].pasta'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2360,220],"id":"9c004549-48e0-4ef9-b3a7-2cf881acbb04","name":"Formatar Dados para Processamento"},{"parameters":{"resource":"folder","name":"Thumb","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-2140,220],"id":"81ed9bd3-a4e1-4a15-9a4e-0a6f0a020949","name":"Criar Pasta para Miniaturas","credentials":{"googleDriveOAuth2Api":{"id":"1AdBBODvkqUgEdur","name":"alex.belini.ti@gmail.com"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Create a prompt for ChatGPT to create an image like a professional photograph based on the theme: {{ $item(\"0\").$node[\"Consolidar Dados do Cartão\"].json[\"output\"][\"0\"][\"título\"] }}. Show a clear and intense emotional expression [choose one: sadness/joy/anger/surprise/fear] appropriate to the title's context. Use lighting that highlights the main subject. Keep the realistic style with vivid colors. No text in the image. High resolution. Provide only the prompt. Return the text without double quotes, with a maximum of 300 characters, clearly and objectively."}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-1920,220],"id":"dd5c9629-c08c-4633-8d0c-ba4d3af7920f","name":"Gerar Descrição para Imagem","credentials":{"openAiApi":{"id":"kJFBDdj4hIWEcn59","name":"OpenAi account"}}},{"parameters":{"method":"POST","url":"https://api.together.xyz/v1/chat/completions","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $item(\"0\").$node[\"Edit Fields\"].json[\"Together API Key\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"black-forest-labs/FLUX.1-schnell\",\n  \"prompt\": {{ JSON.stringify($json.message.content) }},\n  \"width\": 1024,\n  \"height\": 1024,\n  \"steps\": 4,\n  \"n\": 1,\n  \"response_format\": \"b64_json\"\n}","options":{"batching":{"batch":{"batchSize":2,"batchInterval":10000}}}},"id":"297e6e61-7873-45c5-921e-a4ee76fe350f","name":"Solicitar Imagem à Together.xyz","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1320,100],"retryOnFail":true},{"parameters":{"operation":"toBinary","sourceProperty":"output.choices[0].image_base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1100,100],"id":"83b30a18-0c66-416e-b5d0-510ee05ae6bd","name":"Converter Base64 para Arquivo"},{"parameters":{"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $('Criar Pasta para Miniaturas').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-880,100],"id":"18ef6027-fc60-425c-8ae2-2b7a5f220b18","name":"Salvar Imagem no Google Drive","credentials":{"googleDriveOAuth2Api":{"id":"1AdBBODvkqUgEdur","name":"alex.belini.ti@gmail.com"}}},{"parameters":{"operation":"share","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"permissionsUi":{"permissionsValues":{"role":"reader","type":"anyone"}},"options":{}},"id":"5f7caaf1-947d-4a5a-a801-2bb448b54345","name":"Tornar Imagem Pública","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-660,100],"credentials":{"googleDriveOAuth2Api":{"id":"1AdBBODvkqUgEdur","name":"alex.belini.ti@gmail.com"}}},{"parameters":{"url":"=https://api.placid.app/u/{{ $item(\"0\").$node[\"Edit Fields\"].json[\"Placid ID\"] }}?&img[image]={{ $('Salvar Imagem no Google Drive').item.json.webViewLink }}&text[text]={{ $('Formatar Dados para Processamento').item.json['título'] }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-440,100],"id":"18abc15f-3820-4302-8e07-a4cfc2ea879e","name":"Adicionar Texto à Imagem"},{"parameters":{"name":"Thumbnail ","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $('Criar Pasta para Miniaturas').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-220,100],"id":"9dd552d8-c0ec-4ed7-8527-dbf8c99b0fb9","name":"Armazenar Thumbnail Final","retryOnFail":true,"credentials":{"googleDriveOAuth2Api":{"id":"1AdBBODvkqUgEdur","name":"alex.belini.ti@gmail.com"}},"onError":"continueErrorOutput"},{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[-4500,600],"id":"dd0a9f2d-b68c-4f5a-92e6-d6c5f56cd8b3","name":"Detector de Falhas","disabled":true},{"parameters":{"chatId":"-1002628528187","text":"=10 - CRIA THUMB","additionalFields":{"appendAttribution":false,"message_thread_id":3}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-4280,600],"id":"e02fd71a-bc9e-49b4-8f6a-e9930e9012d0","name":"Notificação de Erro no Telegram","webhookId":"490c696d-000c-407d-820b-f9d56ca6111c","disabled":true},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"id\"] }}","mode":""},"updateFields":{"idList":"={{ $item(\"0\").$node[\"Edit Fields\"].json[\"THUMB\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[220,0],"id":"b71a710b-2050-4f0d-b59a-a9e9563a5386","name":"Mover Cartão para \"THUMB ✅\"","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"id\"] }}","mode":"id"},"updateFields":{"desc":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"desc\"] }}\"thumb\": \"{{ $item(\"0\").$node[\"Armazenar Thumbnail Final\"].json[\"id\"] }}\","}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[0,0],"id":"323cbdfe-465b-49ae-91d1-d98380afe40a","name":"Atualizar Detalhes do Cartão","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1320,340],"id":"bc560472-3118-469d-93fb-2b161208cca4","name":"Aguardar e Retentar 1","webhookId":"32ba2aca-6912-4e60-8763-f9c5f34531cc"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a7077994-496c-427f-a27d-a8cd607f7be8","leftValue":"={{ $json.message.content.length }}","rightValue":300,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1540,140],"id":"95eabd70-cde2-4e74-941d-59a59151ed1b","name":"Verificar Caracteres do Prompt"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"015448b3-2848-46c1-92d6-cc3f867bbed1","leftValue":"={{ $json.name }}","rightValue":"\"STOP\"","operator":{"type":"string","operation":"notContains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-3840,220],"id":"893d1cdc-c661-49cb-8d54-62c1dfb88c36","name":"Exclui Cards em \"STOP\""},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"name":"={{ $json.name }} \"STOP\""}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-3400,220],"id":"5e1d651e-c9a1-46a5-a998-19d9c9d9edbc","name":"Atualizar Cartão com \"STOP\"","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"name":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"name\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[440,0],"id":"40153f9f-2f76-4edf-af3d-11b0e01ab912","name":"Remove \"STOP\"","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"id\"] }}","mode":"id"},"updateFields":{"name":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"name\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[0,200],"id":"452821be-7f27-40af-b2af-f2ff7964e070","name":"Remove \"STOP\" 2","credentials":{"trelloApi":{"id":"6gLxfTJw8EfH7C8E","name":"Trello account"}}},{"parameters":{"chatId":"-1002628528187","text":"=10 - CRIA THUMB","additionalFields":{"appendAttribution":false,"message_thread_id":3}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[220,200],"id":"ffb04bf9-0b78-445e-b01c-2f57fdfc0ca9","name":"Notificação de Erro no Telegram 2","webhookId":"e7a8b154-4ece-4b20-a6be-59d20449f959","disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"948aa1b6-75d6-4cf6-9cd1-629b97a571d6","name":"UPLOAD","value":"684e99f4d2ade5c74efc2409","type":"string"},{"id":"41fb9577-343d-439a-bacf-65018b3f194c","name":"THUMB","value":"684e99f4d2ade5c74efc2408","type":"string"},{"id":"c7b22a26-08c8-4644-98cd-01e48b951384","name":"Together API Key","value":"6a22e414358b3232820a65a17b23613f4176cb89329e373fb1cf2d0b5aeac235","type":"string"},{"id":"5c9f7412-0fde-4d7f-83e4-99491599c0e1","name":"Placid ID","value":"trxzohxnxf7ns","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4280,220],"id":"8beabf53-a995-4e16-b296-779e7fc4885e","name":"Edit Fields"},{"parameters":{"rule":{"interval":[{"triggerAtHour":2,"triggerAtMinute":58},{"triggerAtHour":10,"triggerAtMinute":57},{"triggerAtHour":18,"triggerAtMinute":59}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-4500,220],"id":"3fb490ac-a34a-4a04-a77c-6f5f16524708","name":"02:58"}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Extrair Metadados do Cartão","type":"ai_languageModel","index":0}]]},"Buscar Cartões Prontos para Thumbnail":{"main":[[{"node":"Exclui Cards em \"STOP\"","type":"main","index":0}]]},"Selecionar Próximo Cartão":{"main":[[{"node":"Atualizar Cartão com \"STOP\"","type":"main","index":0}]]},"Extrair Metadados do Cartão":{"main":[[{"node":"Consolidar Dados do Cartão","type":"main","index":0}]]},"Formatador de Dados JSON":{"ai_outputParser":[[{"node":"Extrair Metadados do Cartão","type":"ai_outputParser","index":0}]]},"Consolidar Dados do Cartão":{"main":[[{"node":"Extrair Título e Pasta","type":"main","index":0}]]},"Extrair Título e Pasta":{"main":[[{"node":"Formatar Dados para Processamento","type":"main","index":0}]]},"Formatar Dados para Processamento":{"main":[[{"node":"Criar Pasta para Miniaturas","type":"main","index":0}]]},"Criar Pasta para Miniaturas":{"main":[[{"node":"Gerar Descrição para Imagem","type":"main","index":0}]]},"Gerar Descrição para Imagem":{"main":[[{"node":"Verificar Caracteres do Prompt","type":"main","index":0}]]},"Solicitar Imagem à Together.xyz":{"main":[[{"node":"Converter Base64 para Arquivo","type":"main","index":0}]]},"Converter Base64 para Arquivo":{"main":[[{"node":"Salvar Imagem no Google Drive","type":"main","index":0}]]},"Salvar Imagem no Google Drive":{"main":[[{"node":"Tornar Imagem Pública","type":"main","index":0}]]},"Tornar Imagem Pública":{"main":[[{"node":"Adicionar Texto à Imagem","type":"main","index":0}]]},"Adicionar Texto à Imagem":{"main":[[{"node":"Armazenar Thumbnail Final","type":"main","index":0}]]},"Armazenar Thumbnail Final":{"main":[[{"node":"Atualizar Detalhes do Cartão","type":"main","index":0}],[{"node":"Remove \"STOP\" 2","type":"main","index":0}]]},"Detector de Falhas":{"main":[[{"node":"Notificação de Erro no Telegram","type":"main","index":0}]]},"Mover Cartão para \"THUMB ✅\"":{"main":[[{"node":"Remove \"STOP\"","type":"main","index":0}]]},"Atualizar Detalhes do Cartão":{"main":[[{"node":"Mover Cartão para \"THUMB ✅\"","type":"main","index":0}]]},"Aguardar e Retentar 1":{"main":[[{"node":"Gerar Descrição para Imagem","type":"main","index":0}]]},"Verificar Caracteres do Prompt":{"main":[[{"node":"Solicitar Imagem à Together.xyz","type":"main","index":0}],[{"node":"Aguardar e Retentar 1","type":"main","index":0}]]},"Exclui Cards em \"STOP\"":{"main":[[{"node":"Selecionar Próximo Cartão","type":"main","index":0}]]},"Atualizar Cartão com \"STOP\"":{"main":[[{"node":"Extrair Metadados do Cartão","type":"main","index":0}]]},"Remove \"STOP\" 2":{"main":[[{"node":"Notificação de Erro no Telegram 2","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Buscar Cartões Prontos para Thumbnail","type":"main","index":0}]]},"02:58":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:07:49":{"recurrenceRules":[]},"node:02:58":{"recurrenceRules":[]}},"meta":null,"pinData":{},"versionId":"8261bfd3-6f79-4276-a1b8-908e801d1d59","triggerCount":1,"tags":[]}